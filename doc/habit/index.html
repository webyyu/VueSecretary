<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康饮食习惯打卡</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- 标题栏 + 标签行 -->
<!-- ... 省略前面代码 ... -->
<!-- ... 省略前面代码 ... -->
<header>
    <!-- 3D小猫装饰 -->
    <img src="https://cdn-icons-png.flaticon.com/512/590/590685.png" 
        alt="胡萝卜" 
        class="decoration-img" 
        style="z-index:2;">
    <!-- 顶部内容 -->
    <div class="flex-col space-y-3 relative z-10">
      <!-- 标题与标签行 -->
      <div>
        <h1>健康饮食</h1>
        <div class="tag-container">
          <span class="tag-small tag-orange">+1</span>
          <span class="tag tag-green">无需备注</span>
          <span class="tag tag-orange">置顶</span>
        </div>
      </div>
      <!-- 总计条 -->
      <div class="count-card">
        <span class="count-number">16</span>
        <div class="flex-row space-x-3">
          <button class="btn-minus btn-circle">
            <span class="btn-text-gray">-</span>
          </button>
          <button class="btn-plus btn-circle">
            <span class="btn-text-white">+</span>
          </button>
        </div>
      </div>
    </div>
  </header>
  <!-- ... 省略后面代码 ... -->
<!-- ... 省略后面代码 ... -->

    <main>

        <!-- 习惯卡片网格 -->
        <div class="habit-grid">
            <!-- 打羽毛球 -->
            <div class="card">
                <div class="w-full">
                    <div class="card-title">打羽毛球</div>
                    <div class="card-count card-count-light">1</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/2503/2503381.png" alt="羽毛球">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-green">
                            <i class="fas fa-check text-xs icon-badge-check-white"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 发一篇小红书 -->
            <div class="card">
                <div class="w-full">
                    <div class="card-title">发一篇小红书</div>
                    <div class="card-count card-count-light">3</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/2965/2965358.png" alt="笔记本">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-green">
                            <i class="fas fa-check text-xs icon-badge-check-white"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 晚睡 -->
            <div class="card dark">
                <div class="w-full">
                    <div class="card-title card-title-white">晚睡！！！</div>
                    <div class="card-count card-count-dark">4</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/3094/3094837.png" alt="枕头">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-white">
                            <i class="fas fa-plus text-xs icon-badge-plus-dark"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 刷视频 -->
            <div class="card dark">
                <div class="w-full">
                    <div class="card-title card-title-white">刷视频</div>
                    <div class="card-count card-count-dark">2</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/1179/1179069.png" alt="视频">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-green">
                            <i class="fas fa-check text-xs icon-badge-check-white"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 学习打卡记录 -->
            <div class="card">
                <div class="w-full">
                    <div class="card-title">学习打卡记录~</div>
                    <div class="card-count card-count-light">44</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/2921/2921222.png" alt="铅笔">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-light">
                            <i class="fas fa-plus text-xs icon-badge-plus-green"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 看剧 -->
            <div class="card">
                <div class="w-full">
                    <div class="card-title">看剧</div>
                    <div class="card-count card-count-light">27</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/1179/1179069.png" alt="视频">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-light">
                            <i class="fas fa-plus text-xs icon-badge-plus-green"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 做饭 -->
            <div class="card">
                <div class="w-full">
                    <div class="card-title">做饭</div>
                    <div class="card-count card-count-light">8</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/1046/1046857.png" alt="食物">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-light">
                            <i class="fas fa-camera text-xs icon-badge-plus-green"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 化一次妆吧 -->
            <div class="card">
                <div class="w-full">
                    <div class="card-title">化一次妆吧 ~</div>
                    <div class="card-count card-count-light">23</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/1940/1940922.png" alt="口红">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-light">
                            <i class="fas fa-camera text-xs icon-badge-plus-green"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 坚持跑步 -->
            <div class="card">
                <div class="w-full">
                    <div class="card-title">坚持跑步</div>
                    <div class="card-count card-count-light">20</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/2548/2548537.png" alt="跑步">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-light">
                            <i class="fas fa-plus text-xs icon-badge-plus-green"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 喝奶茶 -->
            <div class="card dark">
                <div class="w-full">
                    <div class="card-title card-title-white">喝奶茶</div>
                    <div class="card-count card-count-dark">28</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/2405/2405479.png" alt="奶茶">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-white">
                            <i class="fas fa-plus text-xs icon-badge-plus-dark"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 坚持吃轻食 -->
            <div class="card">
                <div class="w-full">
                    <div class="card-title">坚持吃轻食</div>
                    <div class="card-count card-count-light">0</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/2454/2454297.png" alt="叶子">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-light">
                            <i class="fas fa-camera text-xs icon-badge-plus-green"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 洗的香香的 -->
            <div class="card">
                <div class="w-full">
                    <div class="card-title">洗的香香的</div>
                    <div class="card-count card-count-light">20</div>
                </div>
                <div class="card-icon">
                    <img src="https://cdn-icons-png.flaticon.com/512/2553/2553627.png" alt="沐浴">
                    <div class="absolute bottom-0 right-0">
                        <div class="icon-badge icon-badge-light">
                            <i class="fas fa-plus text-xs icon-badge-plus-green"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 底部导航 -->
    <footer>
        <div class="nav-item">
            <i class="fas fa-home nav-icon-active"></i>
            <span class="nav-text nav-text-active">首页</span>
        </div>
        <div class="nav-item">
            <i class="fas fa-chart-bar nav-icon"></i>
            <span class="nav-text nav-text-inactive">统计</span>
        </div>
        <div class="nav-item">
            <i class="fas fa-plus-circle nav-icon nav-plus"></i>
        </div>
        <div class="nav-item">
            <i class="fas fa-trophy nav-icon"></i>
            <span class="nav-text nav-text-inactive">成就</span>
        </div>
        <div class="nav-item">
            <i class="fas fa-user nav-icon"></i>
            <span class="nav-text nav-text-inactive">我的</span>
        </div>
    </footer>

    <!-- 添加习惯浮动按钮 -->
    <div class="float-btn-container">
        <button id="addHabitBtn" class="float-btn transition-all">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- 添加习惯模态框 -->
    <div id="addHabitModal" class="modal hidden">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content" id="modalContent">
            <div class="modal-header">
                <h3 class="modal-title">添加新习惯</h3>
                <button id="closeModalBtn" class="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addHabitForm" class="space-y-4">
                <!-- 习惯名称 -->
                <div class="form-group">
                    <label for="habitName" class="form-label">习惯名称</label>
                    <input type="text" id="habitName" class="form-input" placeholder="输入习惯名称" required>
                </div>
                
                <!-- 图标选择 -->
                <div class="form-group">
                    <label class="form-label">选择图标</label>
                    <div class="icon-grid" id="iconSelector">
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/2503/2503381.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/2503/2503381.png" alt="羽毛球">
                        </div>
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/2965/2965358.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/2965/2965358.png" alt="笔记本">
                        </div>
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/3094/3094837.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/3094/3094837.png" alt="枕头">
                        </div>
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/1179/1179069.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/1179/1179069.png" alt="视频">
                        </div>
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/2921/2921222.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/2921/2921222.png" alt="铅笔">
                        </div>
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/1046/1046857.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/1046/1046857.png" alt="食物">
                        </div>
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/1940/1940922.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/1940/1940922.png" alt="口红">
                        </div>
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/2548/2548537.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/2548/2548537.png" alt="跑步">
                        </div>
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/2405/2405479.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/2405/2405479.png" alt="奶茶">
                        </div>
                        <div class="icon-option" data-icon="https://cdn-icons-png.flaticon.com/512/2553/2553627.png">
                            <img src="https://cdn-icons-png.flaticon.com/512/2553/2553627.png" alt="沐浴">
                        </div>
                    </div>
                    <input type="hidden" id="selectedIcon" value="" required>
                </div>
                
                <!-- 标签选择 -->
                <div class="form-group">
                    <label class="form-label">选择标签</label>
                    <div class="tag-options">
                        <label class="tag-option">
                            <input type="checkbox" value="健康">
                            <span>健康</span>
                        </label>
                        <label class="tag-option">
                            <input type="checkbox" value="学习">
                            <span>学习</span>
                        </label>
                        <label class="tag-option">
                            <input type="checkbox" value="娱乐">
                            <span>娱乐</span>
                        </label>
                        <label class="tag-option">
                            <input type="checkbox" value="坏习惯">
                            <span>坏习惯</span>
                        </label>
                        <label class="tag-option">
                            <input type="checkbox" value="置顶">
                            <span>置顶</span>
                        </label>
                    </div>
                </div>
                
                <!-- 暗色模式选项 -->
                <div class="checkbox-group">
                    <input type="checkbox" id="darkMode" class="mr-2">
                    <label for="darkMode" class="form-label">使用暗色风格</label>
                </div>
                
                <!-- 按钮 -->
                <div class="btn-container">
                    <button type="button" id="cancelBtn" class="btn btn-cancel">取消</button>
                    <button type="submit" class="btn btn-submit">添加习惯</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 添加交互功能
        document.addEventListener('DOMContentLoaded', function() {
            // 获取页面元素
            const pageTitle = document.querySelector('header h1');
            const countNumber = document.querySelector('.count-number');
            const decreaseBtn = document.querySelector('.btn-circle:first-child');
            const increaseBtn = document.querySelector('.btn-circle:last-child');
            const cards = document.querySelectorAll('.card');
            
            // 添加习惯相关元素
            const addHabitBtn = document.getElementById('addHabitBtn');
            const addHabitModal = document.getElementById('addHabitModal');
            const modalContent = document.getElementById('modalContent');
            const modalOverlay = document.getElementById('modalOverlay');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const addHabitForm = document.getElementById('addHabitForm');
            const iconOptions = document.querySelectorAll('.icon-option');
            const tagOptions = document.querySelectorAll('.tag-option');
            const habitGrid = document.querySelector('.habit-grid');
            
            // 存储所有习惯的数据
            const habits = [];
            
            // 当前选中的习惯索引
            let currentHabitIndex = -1;
            
            // 更新顶部导航栏标签的函数
            function updateHeaderTags(tags) {
                // 获取标签容器
                const tagContainer = document.querySelector('header .flex.items-center.space-x-2');
                
                // 清空现有标签
                tagContainer.innerHTML = '';
                
                // 添加新标签
                tags.forEach(tag => {
                    let tagElement = document.createElement('span');
                    
                    // 根据标签类型设置不同的样式
                    if (tag.value === '健康' || tag.value === '学习') {
                        tagElement.className = 'px-3 py-1 rounded-full bg-green-50 text-green-600 text-sm';
                    } else if (tag.value === '坏习惯') {
                        tagElement.className = 'px-3 py-1 rounded-full bg-red-50 text-red-600 text-sm';
                    } else if (tag.value === '置顶') {
                        tagElement.className = 'px-3 py-1 rounded-full bg-orange-50 text-orange-500 text-sm';
                    } else if (tag.value === '娱乐') {
                        tagElement.className = 'px-3 py-1 rounded-full bg-blue-50 text-blue-600 text-sm';
                    } else {
                        tagElement.className = 'px-3 py-1 rounded-full bg-green-50 text-green-600 text-sm';
                    }
                    
                    tagElement.textContent = tag.value;
                    tagContainer.appendChild(tagElement);
                });
                
                // 如果没有标签，添加默认的+1标签
                if (tags.length === 0) {
                    const defaultTag = document.createElement('span');
                    defaultTag.className = 'px-2 py-0.5 rounded-full bg-orange-50 text-orange-400 text-xs font-semibold';
                    defaultTag.textContent = '+1';
                    tagContainer.appendChild(defaultTag);
                }
            }
            
            // 初始化习惯数据
            cards.forEach((card, index) => {
                const title = card.querySelector('.text-base').textContent;
                const countElement = card.querySelector('.text-orange-500, .text-orange-400');
                const count = parseInt(countElement.textContent);
                const isDark = card.classList.contains('bg-gray-800');
                const isCompleted = card.querySelector('.fa-check') !== null;
                const iconType = card.querySelector('.fa-camera') ? 'camera' : 
                                (card.querySelector('.fa-check') || card.querySelector('.fa-plus')) ? 'check' : '';
                const imgSrc = card.querySelector('img').src;
                
                habits.push({
                    title,
                    count,
                    isDark,
                    isCompleted,
                    iconType,
                    imgSrc,
                    element: card,
                    countElement
                });
            });
            
            // 设置初始总计数值
            let totalCount = 16;
            
            // 更新总计数字显示
            function updateCount() {
                // 添加数字变化动画
                countNumber.style.transform = 'scale(1.1)';
                
                // 如果有选中的习惯，则显示该习惯的计数
                if (currentHabitIndex >= 0) {
                    countNumber.textContent = habits[currentHabitIndex].count;
                } else {
                    countNumber.textContent = totalCount;
                }
                
                setTimeout(() => {
                    countNumber.style.transform = 'scale(1)';
                }, 100);
            }
            
            // 更新卡片计数
            function updateCardCount(index) {
                const habit = habits[index];
                habit.countElement.textContent = habit.count;
            }
            
            // 更新卡片完成状态
            function updateCardStatus(card, isCompleted) {
                const index = Array.from(cards).indexOf(card);
                const habit = habits[index];
                habit.isCompleted = isCompleted;
                
                const iconContainer = card.querySelector('.w-5');
                
                if (isCompleted) {
                    // 变为已完成
                    iconContainer.innerHTML = '<i class="fas fa-check text-xs text-white"></i>';
                    iconContainer.classList.remove('bg-green-100', 'bg-white');
                    iconContainer.classList.add('bg-green-500');
                } else {
                    // 变为未完成
                    if (habit.isDark) {
                        iconContainer.innerHTML = '<i class="fas fa-plus text-xs text-gray-800"></i>';
                        iconContainer.classList.remove('bg-green-500');
                        iconContainer.classList.add('bg-white');
                    } else {
                        const iconClass = habit.iconType === 'camera' ? 'fa-camera' : 'fa-plus';
                        iconContainer.innerHTML = `<i class="fas ${iconClass} text-xs text-green-600"></i>`;
                        iconContainer.classList.remove('bg-green-500');
                        iconContainer.classList.add('bg-green-100');
                    }
                }
            }
            
            // 切换卡片风格
            function toggleCardStyle(card) {
                const index = Array.from(cards).indexOf(card);
                const habit = habits[index];
                
                // 切换暗色/亮色风格
                if (habit.isDark) {
                    // 从暗色变为亮色
                    card.classList.remove('bg-gray-800');
                    card.classList.add('bg-white');
                    card.querySelector('.text-base').classList.remove('text-white');
                    card.querySelector('.text-orange-400').classList.remove('text-orange-400');
                    card.querySelector('.text-orange-400, .text-orange-500').classList.add('text-orange-500');
                    habit.isDark = false;
                } else {
                    // 从亮色变为暗色
                    card.classList.remove('bg-white');
                    card.classList.add('bg-gray-800');
                    card.querySelector('.text-base').classList.add('text-white');
                    card.querySelector('.text-orange-500').classList.remove('text-orange-500');
                    card.querySelector('.text-orange-400, .text-orange-500').classList.add('text-orange-400');
                    habit.isDark = true;
                }
                
                // 更新完成状态图标
                updateCardStatus(card, habit.isCompleted);
            }
            
            // 选择习惯
            function selectHabit(index) {
                currentHabitIndex = index;
                const habit = habits[index];
                
                // 更新标题
                pageTitle.textContent = habit.title;
                
                // 更新总计数字
                updateCount();
                
                // 高亮显示当前选中的卡片
                cards.forEach((card, i) => {
                    if (i === index) {
                        card.classList.add('ring-2', 'ring-blue-500');
                    } else {
                        card.classList.remove('ring-2', 'ring-blue-500');
                    }
                });
            }
            
            // 减少按钮点击事件
            decreaseBtn.addEventListener('click', function() {
                if (currentHabitIndex >= 0) {
                    const habit = habits[currentHabitIndex];
                    if (habit.count > 0) {
                        habit.count--;
                        updateCount();
                        updateCardCount(currentHabitIndex);
                    }
                } else {
                    if (totalCount > 0) {
                        totalCount--;
                        updateCount();
                    }
                }
            });
            
            // 增加按钮点击事件
            increaseBtn.addEventListener('click', function() {
                if (currentHabitIndex >= 0) {
                    const habit = habits[currentHabitIndex];
                    habit.count++;
                    updateCount();
                    updateCardCount(currentHabitIndex);
                } else {
                    totalCount++;
                    updateCount();
                }
            });
            
            // 卡片点击事件
            cards.forEach((card, index) => {
                card.addEventListener('click', function(event) {
                    // 选择该习惯
                    selectHabit(index);
                    
                    // 检查是否点击了状态图标区域
                    const iconContainer = card.querySelector('.w-5');
                    if (event.target === iconContainer || iconContainer.contains(event.target)) {
                        // 切换完成状态
                        const habit = habits[index];
                        updateCardStatus(card, !habit.isCompleted);
                    }
                });
                
                // 双击卡片切换风格
                card.addEventListener('dblclick', function() {
                    toggleCardStyle(card);
                });
            });
            
            // 点击标题栏重置选择
            pageTitle.addEventListener('click', function() {
                currentHabitIndex = -1;
                pageTitle.textContent = '健康饮食';
                updateCount();
                
                // 移除所有卡片的高亮
                cards.forEach(card => {
                    card.classList.remove('ring-2', 'ring-blue-500');
                });
            });
            
            // 添加习惯相关功能
            
            // 打开模态框
            function openModal() {
                addHabitModal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('translate-y-full');
                }, 10);
            }
            
            // 关闭模态框
            function closeModal() {
                modalContent.classList.add('translate-y-full');
                setTimeout(() => {
                    addHabitModal.classList.add('hidden');
                    addHabitForm.reset();
                    // 重置图标选择
                    iconOptions.forEach(option => {
                        option.classList.remove('border-blue-500');
                    });
                    document.getElementById('selectedIcon').value = '';
                    // 重置标签选择
                    tagOptions.forEach(tag => {
                        tag.classList.remove('bg-green-50', 'text-green-600', 'bg-red-50', 'text-red-600', 'bg-orange-50', 'text-orange-600');
                        tag.classList.add('bg-gray-100', 'text-gray-700');
                    });
                }, 200);
            }
            
            // 添加习惯按钮点击事件
            addHabitBtn.addEventListener('click', openModal);
            
            // 关闭模态框事件
            closeModalBtn.addEventListener('click', closeModal);
            cancelBtn.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', closeModal);
            
            // 支持手势下滑关闭
            let startY = 0;
            modalContent.addEventListener('touchstart', function(e) {
                startY = e.touches[0].clientY;
            });
            
            modalContent.addEventListener('touchmove', function(e) {
                const currentY = e.touches[0].clientY;
                const diff = currentY - startY;
                
                if (diff > 0) {
                    modalContent.style.transform = `translateY(${diff}px)`;
                }
            });
            
            modalContent.addEventListener('touchend', function(e) {
                const currentY = e.changedTouches[0].clientY;
                const diff = currentY - startY;
                
                if (diff > 100) {
                    closeModal();
                } else {
                    modalContent.style.transform = '';
                }
            });
            
            // 图标选择
            iconOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 移除其他图标的选中状态
                    iconOptions.forEach(opt => {
                        opt.classList.remove('border-blue-500');
                    });
                    // 添加当前图标的选中状态
                    this.classList.add('border-blue-500');
                    // 保存选中的图标URL
                    document.getElementById('selectedIcon').value = this.dataset.icon;
                });
            });
            
            // 标签选择
            tagOptions.forEach(tag => {
                tag.addEventListener('click', function() {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    
                    if (checkbox.checked) {
                        // 根据标签类型设置不同的样式
                        if (checkbox.value === '健康' || checkbox.value === '学习') {
                            this.classList.remove('bg-gray-100', 'text-gray-700');
                            this.classList.add('bg-green-50', 'text-green-600');
                        } else if (checkbox.value === '坏习惯') {
                            this.classList.remove('bg-gray-100', 'text-gray-700');
                            this.classList.add('bg-red-50', 'text-red-600');
                        } else if (checkbox.value === '置顶') {
                            this.classList.remove('bg-gray-100', 'text-gray-700');
                            this.classList.add('bg-orange-50', 'text-orange-600');
                        } else {
                            this.classList.remove('bg-gray-100', 'text-gray-700');
                            this.classList.add('bg-green-50', 'text-green-600');
                        }
                    } else {
                        // 恢复默认样式
                        this.classList.remove('bg-green-50', 'text-green-600', 'bg-red-50', 'text-red-600', 'bg-orange-50', 'text-orange-600');
                        this.classList.add('bg-gray-100', 'text-gray-700');
                    }
                });
            });
            
            // 表单提交事件
            addHabitForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 获取表单数据
                const habitName = document.getElementById('habitName').value;
                const selectedIcon = document.getElementById('selectedIcon').value;
                const isDarkMode = document.getElementById('darkMode').checked;
                
                // 获取选中的标签
                const selectedTags = [];
                document.querySelectorAll('.tag-option input[type="checkbox"]:checked').forEach(checkbox => {
                    selectedTags.push({
                        value: checkbox.value
                    });
                });
                
                // 验证必填字段
                if (!habitName || !selectedIcon) {
                    alert('请填写习惯名称并选择图标');
                    return;
                }
                
                // 创建新习惯卡片
                const newCard = document.createElement('div');
                newCard.className = `card ${isDarkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow p-4 flex flex-col items-start relative`;
                
                // 设置卡片内容
                newCard.innerHTML = `
                    <div class="w-full">
                        <div class="text-base font-semibold ${isDarkMode ? 'text-white' : ''}">${habitName}</div>
                        <div class="${isDarkMode ? 'text-orange-400' : 'text-orange-500'} font-medium mt-1">0</div>
                    </div>
                    <div class="absolute bottom-3 right-3">
                        <img src="${selectedIcon}" class="w-10 h-10 opacity-70" alt="习惯图标">
                        <div class="absolute bottom-0 right-0">
                            <div class="w-5 h-5 ${isDarkMode ? 'bg-white' : 'bg-green-100'} rounded-full flex items-center justify-center">
                                <i class="fas fa-plus text-xs ${isDarkMode ? 'text-gray-800' : 'text-green-600'}"></i>
                            </div>
                        </div>
                    </div>
                `;
                
                // 添加到网格中
                habitGrid.appendChild(newCard);
                
                // 获取新卡片的元素
                const titleElement = newCard.querySelector('.text-base');
                const countElement = newCard.querySelector('.text-orange-400, .text-orange-500');
                
                // 添加到习惯数组
                const newHabit = {
                    title: habitName,
                    count: 0,
                    isDark: isDarkMode,
                    isCompleted: false,
                    iconType: 'check',
                    imgSrc: selectedIcon,
                    element: newCard,
                    countElement: countElement,
                    tags: selectedTags
                };
                
                habits.push(newHabit);
                
                // 更新卡片列表
                const allCards = document.querySelectorAll('.card');
                const newIndex = habits.length - 1;
                
                // 添加卡片点击事件
                newCard.addEventListener('click', function(event) {
                    // 选择该习惯
                    selectHabit(newIndex);
                    
                    // 检查是否点击了状态图标区域
                    const iconContainer = newCard.querySelector('.w-5');
                    if (event.target === iconContainer || iconContainer.contains(event.target)) {
                        // 切换完成状态
                        updateCardStatus(newCard, !newHabit.isCompleted);
                    }
                });
                
                // 双击卡片切换风格
                newCard.addEventListener('dblclick', function() {
                    toggleCardStyle(newCard);
                });
                
                // 自动选中新添加的习惯
                selectHabit(newIndex);
                
                // 更新顶部导航栏的标签
                updateHeaderTags(selectedTags);
                
                // 关闭模态框
                closeModal();
            });
        });
    </script>
</body>
</html>